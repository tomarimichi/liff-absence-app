<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="padding:20px;font-family:sans-serif;">
  <h3>æ¬ å¸­é€£çµ¡ãƒ•ã‚©ãƒ¼ãƒ </h3>
  <div style="color:green;font-weight:bold;">
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userId">èª­ã¿è¾¼ã¿ä¸­...</span>
  </div>
  <p>12:42</p>
  <p>æ¬ å¸­ç†ç”±: 
    <select id="reason">
      <option>ä½“èª¿ä¸è‰¯</option>
      <option>é€šé™¢</option>
      <option>å®¶åº­äº‹æƒ…</option>
    </select>
  </p>
  <p>æ¬ å¸­æ—¥: <input type="date" id="nextdate"></p>

<!-- ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³è¿½åŠ ï¼ˆé€ä¿¡ãƒœã‚¿ãƒ³ã®ç›´å‰ï¼‰ -->
<button onclick="testFetch()" style="padding:10px 20px;background:#ff9900;color:white;border:none;border-radius:5px;margin:10px 0;">[ãƒ†ã‚¹ãƒˆ]GASé€šä¿¡ç¢ºèª</button>
// <script>å†…ã«è¿½åŠ ï¼ˆsubmitAbsence()ã®å‰ï¼‰
async function testFetch() {
  alert('ğŸ” GASãƒ†ã‚¹ãƒˆé–‹å§‹');
  
  const testData = { test: 'ping', timestamp: new Date().toISOString() };
  
  try {
    const result = await fetch(GAS_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(testData)
    });
    
    alert('âœ… GASé€šä¿¡æˆåŠŸï¼ï¼ˆGASãƒ­ã‚°ç¢ºèªï¼‰');
    
  } catch (error) {
    alert('âŒ fetchã‚¨ãƒ©ãƒ¼: ' + error.message);
  }
}
<!--ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã“ã“ã¾ã§-->
  
  <button onclick="submitAbsence()" style="padding:12px 24px;font-size:16px;background:#00b900;color:white;border:none;border-radius:5px;">æ¬ å¸­é€£çµ¡ã‚’é€ä¿¡</button>

  <script>
    async function initLiff() {
      try {
        await liff.init({ liffId: '2008657935-a7glOyOk' });
        console.log('LIFF initæˆåŠŸ');
        
        if (!liff.isLoggedIn()) {
          console.log('æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ­ã‚°ã‚¤ãƒ³è¦æ±‚');
          liff.login({ redirectUri: window.location.href });
          return;
        }
        
        console.log('ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿');
        
        const idToken = liff.getDecodedIDToken();
        console.log('IDãƒˆãƒ¼ã‚¯ãƒ³:', idToken ? 'å–å¾—æˆåŠŸ' : 'null');
        
        if (idToken && idToken.sub) {
          document.getElementById('userId').textContent = idToken.sub.substring(0, 20) + '...';
          document.getElementById('userId').style.color = 'green';
        } else {
          document.getElementById('userId').textContent = 'IDå–å¾—å¤±æ•—ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰';
          document.getElementById('userId').style.color = 'red';
        }
        
        document.getElementById('nextdate').valueAsDate = new Date();
        
      } catch (error) {
        console.error('LIFFã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('userId').textContent = 'LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message;
        document.getElementById('userId').style.color = 'red';
      }
    }

    async function submitAbsence() {
      const idToken = liff.getDecodedIDToken();
      const data = {
        userId: idToken.sub,
        reason: document.getElementById('reason').value,
        nextdate: document.getElementById('nextdate').value
      };

      const GAS_URL = 'https://script.google.com/macros/s/AKfycbyw1Z_Hg374OSYbZ31RGHGHBGUSIfWJCe927pNF8MqIheilggD0ghl7butV9W8eysOQ7w/exec';

      try {
        await fetch(GAS_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        });

        await liff.sendMessages([{
          type: 'text',
          text: `ã€æ¬ å¸­é€£çµ¡ã€‘\nåˆ©ç”¨è€…ID: ${data.userId.substring(0,15)}...\næ¬ å¸­ç†ç”±: ${data.reason}\næ¬ å¸­æ—¥: ${data.nextdate}`
        }]);

        alert('âœ… æ¬ å¸­é€£çµ¡ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„');
        liff.closeWindow();

      } catch (e) {
        await liff.sendMessages([{
          type: 'text',
          text: `ã€æ¬ å¸­é€£çµ¡ã€‘\nåˆ©ç”¨è€…ID: ${data.userId.substring(0,15)}...\næ¬ å¸­ç†ç”±: ${data.reason}\næ¬ å¸­æ—¥: ${data.nextdate}\nï¼ˆé€ä¿¡ç¢ºèªä¸­ï¼‰`
        }]);
        alert('âœ… LINEé€šçŸ¥å®Œäº†ï¼GASç¢ºèªã‚’');
      }
    }

    initLiff();
  </script>
</body>
</html>





